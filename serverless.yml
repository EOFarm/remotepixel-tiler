service: ${opt:sat}-tiler

provider:
  name: aws
  runtime: python3.6
  stage: ${opt:stage, 'production'}
  region: ${file(./satellites/${opt:sat}.yml):region}
  iamRoleStatements: ${file(./satellites/${opt:sat}.yml):iam}
  deploymentBucket: remotepixel-${self:provider.region}
  environment: ${file(./satellites/${opt:sat}.yml):env}
  usagePlan:
    throttle:
      burstLimit: 1000
      rateLimit: 500

custom:
  contentEncoding:
    minimumCompressionSize: 0
  apigwBinary:
    types:
      - '*/*'
  alerts:
    dashboards: false
    topics:
      alarm:
        topic: ${self:service}-${self:provider.stage}-alerts-alarm
        notifications:
          - protocol: email
            endpoint: ${file(./config.json):mail}
    definitions:
      functionInvocations:
        threshold: 1000
      functionErrors:
        threshold: 100

plugins:
  - serverless-plugin-aws-alerts
  - serverless-content-encoding
  - serverless-apigw-binary

package:
  artifact: package.zip

functions: ${file(./satellites/${opt:sat}.yml):functions}
